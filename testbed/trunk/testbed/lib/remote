#!/bin/bash

# Globals
CLIENT_NAME_PREFIX="client"

run_command_on_client()
{
	local user=$1
	local host=$2
	local command=$3
	verbose "executing '$command' on client $host"
	verbose "$host $(ssh $user@$host "$command")" "-e"
}

copy_file_to_host()
{
	local user=$1
	local host=$2
	local file=$3
	verbose "copying file $file to $host"
	verbose "$(scp $file $user@$host:/tmp)"
}

run_command_on_all_clients()
{
	local user=$1
	local command=$2
	local pids=
	for c in $CLIENTS
	do
		run_command_on_client $user "$CLIENT_NAME_PREFIX$c" "$command" &
		pids="$pids $(echo $!)"
	done
	# wait for jobs to finish
	for p in $pids
	do
		verbose "waiting for command to finish - pid $p"
		wait $p
	done
}
